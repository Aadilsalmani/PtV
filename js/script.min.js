console.time("loadTime");const map=L.map("map").setView([28.6139,77.209],5);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(map);const tableBody=document.querySelector("#places-table tbody");let allPlaces=[],markers=[],userLat,userLon;function getDistance(e,t,r,a){let l=Math.sin((r-e)*Math.PI/180/2)**2+Math.cos(e*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin((a-t)*Math.PI/180/2)**2;return 12742*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}function locateUser(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{userLat=e.coords.latitude,userLon=e.coords.longitude,map.setView([userLat,userLon],12),L.marker([userLat,userLon]).addTo(map).bindPopup("You are here").openPopup(),applyFilters()},e=>{alert("Location access denied. Showing all data."),applyFilters()}):(alert("Geolocation not supported"),applyFilters())}function applyFilters(){let e=Array.from(document.querySelectorAll(".pop-check:checked")).map(e=>e.value),t=document.getElementById("distanceFilter").value;tableBody.innerHTML="",markers.forEach(e=>map.removeLayer(e)),markers=[];let r=allPlaces.filter(r=>{if(!r.Latitude||!r.Longitude)return!1;let a=!0;return userLat&&userLon?r.Distance=getDistance(userLat,userLon,r.Latitude,r.Longitude):r.Distance=null,e.includes(r.Popularity)||(a=!1),"All"!==t&&null!==r.Distance&&r.Distance>parseFloat(t)&&(a=!1),a});userLat&&userLon&&r.sort((e,t)=>e.Distance-t.Distance);let a=r.slice(0,200);a.forEach(e=>{let t=L.marker([e.Latitude,e.Longitude]).addTo(map);t.bindPopup(`<b>${e.Name}</b><br>${e.Category}<br>${e.Popularity}<br>${e.Distance?e.Distance.toFixed(2)+" km":""}`),markers.push(t);let r=document.createElement("tr");r.innerHTML=`
      <td>${e.Name}</td>
      <td>${e.Category}</td>
      <td>${e.Popularity}</td>
      <td>${e.Distance?e.Distance.toFixed(2):"-"}</td>
    `,r.addEventListener("click",()=>{map.setView([e.Latitude,e.Longitude],14),t.openPopup()}),tableBody.appendChild(r)}),document.getElementById("loading-overlay").style.display="none",console.timeEnd("loadTime")}fetch("data/tourist_data.json").then(e=>e.json()).then(e=>{allPlaces=e,locateUser()}),document.querySelectorAll(".pop-check").forEach(e=>e.addEventListener("change",applyFilters)),document.getElementById("distanceFilter").addEventListener("change",applyFilters),lucide.createIcons();const filterToggle=document.getElementById("filter-toggle"),filterBar=document.getElementById("filter-bar"),filterOverlay=document.getElementById("filter-overlay");filterToggle.addEventListener("click",()=>{let e=filterBar.classList.toggle("show");filterOverlay.style.display=e?"block":"none"}),filterOverlay.addEventListener("click",()=>{filterBar.classList.remove("show"),filterOverlay.style.display="none"}),"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js").then(()=>console.log("Service Worker registered")).catch(e=>console.error("SW registration failed:",e));